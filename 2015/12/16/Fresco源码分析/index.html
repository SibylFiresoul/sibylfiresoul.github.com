<!doctype html>
<html class="theme-next   use-motion ">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.4.5.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.2" />






<meta name="description" content="Fresco源码分析Fresco的MVC模型：M -&amp;gt; DraweeHierarchy  保存和管理图像层次；V -&amp;gt; DraweeView          显示DraweeHierarchy的顶层图像；C -&amp;gt; DraweeController 管理其他组件，设置视图层次；DraweeHolder：controller和hierarchy的持有类，DraweeView 通过此">
<meta property="og:type" content="article">
<meta property="og:title" content="Fresco源码分析">
<meta property="og:url" content="http://yoursite.com/2015/12/16/Fresco源码分析/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Fresco源码分析Fresco的MVC模型：M -&amp;gt; DraweeHierarchy  保存和管理图像层次；V -&amp;gt; DraweeView          显示DraweeHierarchy的顶层图像；C -&amp;gt; DraweeController 管理其他组件，设置视图层次；DraweeHolder：controller和hierarchy的持有类，DraweeView 通过此">
<meta property="og:image" content="http://yoursite.com/images/pic01.png">
<meta property="og:updated_time" content="2015-12-16T03:05:57.075Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Fresco源码分析">
<meta name="twitter:description" content="Fresco源码分析Fresco的MVC模型：M -&amp;gt; DraweeHierarchy  保存和管理图像层次；V -&amp;gt; DraweeView          显示DraweeHierarchy的顶层图像；C -&amp;gt; DraweeController 管理其他组件，设置视图层次；DraweeHolder：controller和hierarchy的持有类，DraweeView 通过此">



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: '',
    sidebar: 'post',
    motion: true
  };
</script>

  <title> Fresco源码分析 | Hexo </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  






  <div class="container one-column page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Hexo</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首頁
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            歸檔
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            標籤
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Fresco源码分析
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            發表於
            <time itemprop="dateCreated" datetime="2015-12-16T10:40:14+08:00" content="2015-12-16">
              2015-12-16
            </time>
          </span>

          

          
            
          

          

        </div>
      </header>
    


    <div class="post-body">

      
      

      
        <span itemprop="articleBody"><h1 id="Fresco_u6E90_u7801_u5206_u6790"><a href="#Fresco_u6E90_u7801_u5206_u6790" class="headerlink" title="Fresco源码分析"></a>Fresco源码分析</h1><p>Fresco的MVC模型：<br>M -&gt; DraweeHierarchy  保存和管理图像层次；<br>V -&gt; DraweeView          显示DraweeHierarchy的顶层图像；<br>C -&gt; DraweeController 管理其他组件，设置视图层次；<br>DraweeHolder：controller和hierarchy的持有类，DraweeView 通过此类和controller和hierarchy交互，起到解耦作用。</p>
<p>DraweeHierarchy ：Fresco提供了诸如占位图（加载中，加载失败显示的图片），进度条，渐进式JPEG图，多图请求及图片复用等效果，也就是说根据图片加载过程中的不同状态要显示不同效果的图片，所以需要图像的分层管理。<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">DraweeHierarchy</span> &#123;</span><br><span class="line">  <span class="function">Drawable <span class="title">getTopLevelDrawable</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>DraweeHierarchy代表了一个Drawee的层次，它内部维持了一个树状数据结构，DraweeHierarchy对外屏蔽了一切具体细节，只提供the top level drawable用于DraweeView的动态显示。</p>
<p>SettableDraweeHierarchy：继承自DraweeHierarchy并提供了一些基本的功能。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">SettableDraweeHierarchy</span> <span class="keyword">extends</span> <span class="title">DraweeHierarchy</span> </span>&#123;</span><br><span class="line">  <span class="comment">//将图层重置到初始状态</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">reset</span><span class="params">()</span></span>;</span><br><span class="line">  <span class="comment">//设置目标显示图片</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setImage</span><span class="params">(Drawable drawable, <span class="keyword">float</span> progress, <span class="keyword">boolean</span> immediate)</span></span>;</span><br><span class="line">  <span class="comment">//设置进度条的进度</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setProgress</span><span class="params">(<span class="keyword">float</span> progress, <span class="keyword">boolean</span> immediate)</span></span>;</span><br><span class="line">  <span class="comment">//设置加载失败时的图片</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setFailure</span><span class="params">(Throwable throwable)</span></span>;</span><br><span class="line">  <span class="comment">//设置加载失败，但用户点击该图片可以重新加载</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setRetry</span><span class="params">(Throwable throwable)</span></span>;</span><br><span class="line">  <span class="comment">//设置改图片覆盖已有的图层</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setControllerOverlay</span><span class="params">(Drawable drawable)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上方法只能由controllers调用！</p>
<p>GenericDraweeHierarchy ：实现了SettableDraweeHierarchy的基本方法，是负责装载每个图层信息的载体。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GenericDraweeHierarchy</span> <span class="keyword">implements</span> <span class="title">SettableDraweeHierarchy</span> </span>&#123;&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/images/pic01.png" style="width: 500px;"><br>主要有顶级图层，占位符图层，目标显示图层，重新加载图层，显示失败图层，    进度条图层，控制覆盖图层。这些图层的代码位于drawable文件夹。<br>GenericDraweeHierarchy 的构建是通过GenericDraweeHierarchyBuilder完成的，这是典型的builder设计模式。<br>在GenericDraweeHierarchyBuilder可以通过一系列set方法设置诸如setPlaceholderImage，setFailureImage，setRetryImage，setProgressBarImage，setBackground（setBackgrounds），setOverlay(setOverlays),setPressedStateOverlay设置以上图层。<br>GenericDraweeHierarchy在初始化的时候会从GenericDraweeHierarchyBuilder提取出这些设置值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> numLayers = <span class="number">0</span>;<span class="comment">//图层数</span></span><br></pre></td></tr></table></figure>
<p>经过如下分支：</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//backgrounds</span><br><span class="line">int numBackgrounds = (builder.getBackgrounds() != null) ? builder.getBackgrounds().size() : 0<span class="comment">;</span></span><br><span class="line">int backgroundsIndex = numLayers<span class="comment">;</span></span><br><span class="line">numLayers += numBackgrounds<span class="comment">;</span></span><br><span class="line"></span><br><span class="line">//placeholder image branch</span><br><span class="line">Drawable placeholderImageBranch = builder.getPlaceholderImage()<span class="comment">;</span></span><br><span class="line">if (placeholderImageBranch == null) &#123;</span><br><span class="line">  placeholderImageBranch = getEmptyPlaceholderDrawable()<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line">placeholderImageBranch = maybeApplyRoundingBitmapOnly(</span><br><span class="line">    mRoundingParams,</span><br><span class="line">    mResources,</span><br><span class="line">    placeholderImageBranch)<span class="comment">;</span></span><br><span class="line">placeholderImageBranch = maybeWrapWithScaleType(</span><br><span class="line">    placeholderImageBranch,</span><br><span class="line">    builder.getPlaceholderImageScaleType())<span class="comment">;</span></span><br><span class="line">mPlaceholderImageIndex = numLayers++<span class="comment">;</span></span><br><span class="line">以下分支代码略</span><br></pre></td></tr></table></figure>
<p>将对应的图层依次序存储在数组layers中：<br><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Drawable<span class="string">[]</span> layers = new Drawable<span class="string">[numLayers]</span>;</span><br><span class="line">   if (numBackgrounds &gt; <span class="number">0</span>) &#123;</span><br><span class="line">     int index = <span class="number">0</span>;</span><br><span class="line">     for (Drawable background : builder.getBackgrounds()) &#123;</span><br><span class="line">       layers<span class="string">[backgroundsIndex + index++]</span> =</span><br><span class="line">           maybeApplyRoundingBitmapOnly(mRoundingParams, mResources, background);</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br><span class="line">   layers<span class="string">[mPlaceholderImageIndex]</span> = placeholderImageBranch;</span><br><span class="line">   layers<span class="string">[mActualImageIndex]</span> = actualImageBranch;</span><br><span class="line">   layers<span class="string">[mProgressBarImageIndex]</span> = progressBarImageBranch;</span><br><span class="line">   layers<span class="string">[mRetryImageIndex]</span> = retryImageBranch;</span><br><span class="line">   layers<span class="string">[mFailureImageIndex]</span> = failureImageBranch;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//包装成FadeDrawable</span></span><br><span class="line">mFadeDrawable = <span class="keyword">new</span> FadeDrawable(layers);</span><br><span class="line">mFadeDrawable.setTransitionDuration(builder.getFadeDuration());</span><br><span class="line"></span><br><span class="line"><span class="comment">//是否圆角处理</span></span><br><span class="line">Drawable maybeRoundedDrawable =</span><br><span class="line">    maybeWrapWithRoundedOverlayColor(mRoundingParams, mFadeDrawable);</span><br><span class="line"></span><br><span class="line"><span class="comment">//顶层图片处理</span></span><br><span class="line">mTopLevelDrawable = <span class="keyword">new</span> RootDrawable(maybeRoundedDrawable);</span><br><span class="line">mTopLevelDrawable.mutate();</span><br></pre></td></tr></table></figure>
<p>FadeDrawable继承自ArrayDrawable，ArrayDrawable包含了一个Drawables（layers）的数组,会按照数组的顺序进行绘制，角标最大的元素会被绘制在最上层。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">draw</span><span class="params">(Canvas canvas)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mLayers.length; i++) &#123;</span><br><span class="line">      Drawable drawable = mLayers[i];</span><br><span class="line">      <span class="keyword">if</span> (drawable != <span class="keyword">null</span>) &#123;</span><br><span class="line">        drawable.draw(canvas);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>ArrayDrawable还实现了TransformCallback, TransformAwareDrawable 接口，用以获取父图层的变换矩阵。<br>FadeDrawable还提供了显示/隐藏图层和渐变显示功能：<br>setTransitionDuration(int durationMs) 设置隐藏/显示图层渐变动画时间。<br>updateAlphas根据经过和持续时间计算当前的透明度。<br>fadeInLayer(int index) 显示指定图层。<br>fadeOutLayer(int index) 隐藏指定图层。<br>fadeInAllLayers() 显示所有图层。<br>fadeOutAllLayers() 隐藏所有图层。<br>fadeToLayer(int index) 显示指定图层同时隐藏其他图层。<br>fadeUpToLayer(int index) 隐藏数组下标&lt;=index的图层。</p>
<p>RootDrawable继承自ForwardingDrawable，并实现了VisibilityAwareDrawable接口，用以在自身可见度改变的时候的通知函数（onVisibilityChange(boolean visible)）和在自身绘制时通知回调(onDraw())。<br>ForwardingDrawable提供getCurrent()回去当前的容器：<br><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function">Drawable <span class="title">getCurrent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mCurrentDelegate;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>其设计哲学是 ，有助于重用，就像安卓原生的DrawableContainer, LevelListDrawable类那样。</p>
<p>DraweeView用于显示DraweeHierarchy。需要先设置hierarchy和controller。</p>
<p>void init(Context context) 初始化DraweeHolder；<br>void setHierarchy(DH hierarchy) 设置图层树并显示top level drawable<br>void setController(@Nullable DraweeController draweeController) 设置DraweeController并显示top level drawable<br>Drawable getTopLevelDrawable() 获取top level drawable；<br>View中的onAttachedToWindow()、 onDetachedFromWindow()、 onStartTemporaryDetach()、 onFinishTemporaryDetach() 四个回调函数，提供当视图被绑定/解绑到指定布局上时的回调函数，它们会触发DraweeHolder的onDetach()或onAttach()；</p>
<p>设置目标图片是Controller的行为，DraweeView并不支持ImageView的setImageXxx, setScaleType和类似的方法。只有把DraweeView当作是原生的ImageView时才能调用DraweeView的如下方法：<br>setImageDrawable(Drawable drawable)<br>setImageBitmap(Bitmap bm)<br>setImageResource(int resId)<br>setImageURI(Uri uri)<br>这是并没有使用到Fresco的缓存和加载机制。</p>
<p>DraweeHolder是包含了controller和hierarchy的持有类。DraweeView的所有方法和操作都是调用了DraweeHolder的相关方法实现的。</p>
<p>void setHierarchy(DH hierarchy)在构造方法和DraweeView.setHierarchy中被调用，将DraweeHierarchy传给持有的DraweeControlle。<br>setController(@Nullable DraweeController draweeController)无条件解绑旧的Controller，并将旧DraweeController的DraweeHierarchy设置为null，并调用DraweeController.onDetach()将它变为解除绑定状态；将持有的DraweeHierarchy赋给新传入的DraweeController并调用DraweeController.onAttach()让它变为绑定状态。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">setController</span><span class="params">(@Nullable DraweeController draweeController)</span> </span>&#123;</span><br><span class="line">   <span class="keyword">boolean</span> wasAttached = mIsControllerAttached;</span><br><span class="line">   <span class="keyword">if</span> (wasAttached) &#123;</span><br><span class="line">     detachController();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// Clear the old controller</span></span><br><span class="line">   <span class="keyword">if</span> (mController != <span class="keyword">null</span>) &#123;</span><br><span class="line">     mEventTracker.recordEvent(Event.ON_CLEAR_OLD_CONTROLLER);</span><br><span class="line">     mController.setHierarchy(<span class="keyword">null</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   mController = draweeController;</span><br><span class="line">   <span class="keyword">if</span> (mController != <span class="keyword">null</span>) &#123;</span><br><span class="line">     mEventTracker.recordEvent(Event.ON_SET_CONTROLLER);</span><br><span class="line">     mController.setHierarchy(mHierarchy);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     mEventTracker.recordEvent(Event.ON_CLEAR_CONTROLLER);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> (wasAttached) &#123;</span><br><span class="line">     attachController();</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>mController.setHierarchy(mHierarchy);之后发生了什么会在后文中记述。</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GenericDraweeView <span class="keyword">extends</span> DraweeView&lt;GenericDraweeHierarchy&gt;</span><br></pre></td></tr></table></figure>
<p>GenericDraweeView就是使用GenericDraweeHierarchy图层树的视图，GenericDraweeHierarchy图层的属性是从XML文件中获取到的。<br>这些属性如下：</p>
<ul>
<li>Fading animation parameters:<ul>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_fadeDuration</li>
<li>Images &amp; scale types parameters:</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_viewAspectRatio</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_placeholderImage</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_placeholderImageScaleType</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_retryImage</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_retryImageScaleType</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_failureImage</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_failureImageScaleType</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_progressBarImage</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_progressBarImageScaleType</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_progressBarAutoRotateInterval</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_actualImageScaleType</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_backgroundImage</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_overlayImage</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_pressedStateOverlayImage</li>
<li>Rounding parameters:</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundAsCircle</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundedCornerRadius</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundTopLeft</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundTopRight</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundBottomRight</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundBottomLeft</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundWithOverlayColor</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundingBorderWidth</li>
<li>@attr ref com.facebook.R.styleable#GenericDraweeView_roundingBorderColor<br>aspectRatio 图片的长宽比；</li>
</ul>
</li>
</ul>
<p>在inflateHierarchy方法中从XML文件中读出相关属性，并将这些属性通过GenericDraweeHierarchyBuilder完成构造，最后通过setHierarchy(builder.build())传递给GenericDraweeView。</p>
<p> 而 SimpleDraweeView继承自GenericDraweeView，内部提供了DraweeController的简单实现。<br><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Supplier</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">  T <span class="keyword">get</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> Supplier&lt;? <span class="keyword">extends</span> SimpleDraweeControllerBuilder&gt; sDraweeControllerBuilderSupplier;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> initialize(</span><br><span class="line">      Supplier&lt;? <span class="keyword">extends</span> SimpleDraweeControllerBuilder&gt; draweeControllerBuilderSupplier) &#123;</span><br><span class="line">    sDraweeControllerBuilderSupplier = draweeControllerBuilderSupplier;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> init() &#123;</span><br><span class="line">    <span class="keyword">if</span> (isInEditMode()) &#123;</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Preconditions.checkNotNull(</span><br><span class="line">        sDraweeControllerBuilderSupplier,</span><br><span class="line">        <span class="string">"SimpleDraweeView was not initialized!"</span>);</span><br><span class="line">    mSimpleDraweeControllerBuilder = sDraweeControllerBuilderSupplier.<span class="keyword">get</span>();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>setImageURI方法：<br><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public void <span class="built_in">set</span>ImageURI(Uri uri, @Nullable Object callerContext) &#123;</span><br><span class="line">  DraweeController controller = mSimpleDraweeControllerBuilder</span><br><span class="line">      .<span class="built_in">set</span>CallerContext(callerContext)</span><br><span class="line">      .<span class="built_in">set</span>Uri(uri)</span><br><span class="line">      .<span class="built_in">set</span>OldController(getController())</span><br><span class="line">      .build();</span><br><span class="line">  <span class="built_in">set</span>Controller(controller);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>下面到了controller的部分：<br>The view forwards events to the controller. The controller controls its hierarchy based on those events.<br><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">DraweeController</span> &#123;</span><br><span class="line">  <span class="function">DraweeHierarchy <span class="title">getHierarchy</span>(<span class="params"></span>)</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">setHierarchy</span>(<span class="params">@Nullable DraweeHierarchy hierarchy</span>)</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">onAttach</span>(<span class="params"></span>)</span>;</span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">onDetach</span>(<span class="params"></span>)</span>;</span><br><span class="line">  <span class="function">boolean <span class="title">onTouchEvent</span>(<span class="params">MotionEvent <span class="keyword">event</span></span>)</span>;</span><br><span class="line">  <span class="function">Animatable <span class="title">getAnimatable</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractDraweeController</span>&lt;<span class="title">T</span>, <span class="title">INFO</span>&gt; <span class="keyword">implements</span></span><br><span class="line">    <span class="title">DraweeController</span>,</span><br><span class="line">    <span class="title">DeferredReleaser</span>.<span class="title">Releasable</span>,</span><br><span class="line">    <span class="title">GestureDetector</span>.<span class="title">ClickListener</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>DraweeView在onAttachedToWindow()方法中调用mDraweeHolder.onAttach();该方法内部调用 mController.onAttach();</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mController != <span class="literal">null</span> &amp;&amp;</span><br><span class="line">       mController.getHierarchy() != <span class="literal">null</span>) &#123;</span><br><span class="line">     mController.onAttach();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>会先判断是否已经给mController设置了hierarchy。<br>下面我们看AbstractDraweeController的onAttach()方法内部的submitRequest()方法。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="function"><span class="keyword">void</span> <span class="title">submitRequest</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  getControllerListener().onSubmit(mId, mCallerContext);</span><br><span class="line">  mSettableDraweeHierarchy.setProgress(<span class="number">0</span>, <span class="keyword">true</span>);</span><br><span class="line">  mIsRequestSubmitted = <span class="keyword">true</span>;</span><br><span class="line">  mHasFetchFailed = <span class="keyword">false</span>;</span><br><span class="line">  mDataSource = getDataSource();</span><br><span class="line">  <span class="keyword">final</span> String id = mId;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">boolean</span> wasImmediate = mDataSource.hasResult();</span><br><span class="line">  <span class="keyword">final</span> DataSubscriber&lt;T&gt; dataSubscriber =</span><br><span class="line">      <span class="keyword">new</span> BaseDataSubscriber&lt;T&gt;() &#123;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onNewResultImpl</span><span class="params">(DataSource&lt;T&gt; dataSource)</span> </span>&#123;</span><br><span class="line">          <span class="comment">// isFinished must be obtained before image, otherwise we might set intermediate result</span></span><br><span class="line">          <span class="comment">// as final image.</span></span><br><span class="line">          <span class="keyword">boolean</span> isFinished = dataSource.isFinished();</span><br><span class="line">          <span class="keyword">float</span> progress = dataSource.getProgress();</span><br><span class="line">          T image = dataSource.getResult();</span><br><span class="line">          <span class="keyword">if</span> (image != <span class="keyword">null</span>) &#123;</span><br><span class="line">            onNewResultInternal(id, dataSource, image, progress, isFinished, wasImmediate);</span><br><span class="line">          &#125; <span class="function"><span class="keyword">else</span> <span class="title">if</span> <span class="params">(isFinished)</span> </span>&#123;</span><br><span class="line">            onFailureInternal(id, dataSource, <span class="keyword">new</span> NullPointerException(), <span class="comment">/* isFinished */</span> <span class="keyword">true</span>);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onFailureImpl</span><span class="params">(DataSource&lt;T&gt; dataSource)</span> </span>&#123;</span><br><span class="line">          onFailureInternal(id, dataSource, dataSource.getFailureCause(), <span class="comment">/* isFinished */</span> <span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="annotation">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onProgressUpdate</span><span class="params">(DataSource&lt;T&gt; dataSource)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">boolean</span> isFinished = dataSource.isFinished();</span><br><span class="line">          <span class="keyword">float</span> progress = dataSource.getProgress();</span><br><span class="line">          onProgressUpdateInternal(id, dataSource, progress, isFinished);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">  mDataSource.subscribe(dataSubscriber, mUiThreadImmediateExecutor);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>发现这是观察者设计模式，DataScriber订阅了DataSource的信息，在不同的回调函数中onNewResultImpl，onFailureImpl，onProgressUpdate对DraweeHierarchy做出相应的处理。<br>下面是图片加载失败情况下的主要代码：</p>
<figure class="highlight vbscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isFinished) &#123;</span><br><span class="line">     mDataSource = <span class="literal">null</span>;</span><br><span class="line">     mHasFetchFailed = <span class="literal">true</span>;</span><br><span class="line">     <span class="keyword">if</span> (mRetainImageOnFailure &amp;&amp; mDrawable != <span class="literal">null</span>) &#123;</span><br><span class="line">       mSettableDraweeHierarchy.setImage(mDrawable, <span class="number">1</span>f, <span class="literal">true</span>);</span><br><span class="line">     &#125; <span class="keyword">else</span> <span class="keyword">if</span> (shouldRetryOnTap()) &#123;</span><br><span class="line">       mSettableDraweeHierarchy.setRetry(throwable);</span><br><span class="line">     &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       mSettableDraweeHierarchy.setFailure(throwable);</span><br><span class="line">     &#125;</span><br><span class="line">     getControllerListener().onFailure(<span class="built_in">mId</span>, throwable);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     logMessageAndFailure(<span class="string">"intermediate_failed @ onFailure"</span>, throwable);</span><br><span class="line">     getControllerListener().onIntermediateImageFailed(<span class="built_in">mId</span>, throwable);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>AbstractDraweeController是通过AbstractDraweeControllerBuilder的build()方法构建的。<br>其重要方法还有Supplier<datasource<image>&gt; obtainDataSourceSupplier()，<br>获取被controller使用的the top-level数据源的supplier 。</datasource<image></p>
<p>参考文章：<a href="https://github.com/desmond1121/Fresco-Source-Analysis" target="_blank" rel="external">https://github.com/desmond1121/Fresco-Source-Analysis</a></p>
</span>
      
    </div>

    <footer class="post-footer">
      

      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


        </div>

        


        
  <div class="comments" id="comments">
    
  </div>


      </div>

      
        
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目錄
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            本站概覽
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="John Doe" itemprop="image"/>
          <p class="site-author-name" itemprop="name">John Doe</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">1</span>
              <span class="site-state-item-name">文章</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分類</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">標籤</span>
              </a>
          </div>

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc-indicator-top post-toc-indicator">
            <i class="fa fa-angle-double-up"></i>
          </div>
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Fresco_u6E90_u7801_u5206_u6790"><span class="nav-number">1.</span> <span class="nav-text">Fresco源码分析</span></a></li></ol></div>
            
          </div>
          <div class="post-toc-indicator-bottom post-toc-indicator">
            <i class="fa fa-angle-double-down"></i>
          </div>
        </section>
      

    </div>
  </aside>


      
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2015</span>
  <span class="with-love">
    <i class="icon-next-heart fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 強力驅動
</div>

<div class="theme-info">
  主題 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
    
    

  


  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.2"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.2"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
<script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

<script type="text/javascript" src="/js/motion.js?v=0.4.5.2" id="motion.global"></script>


  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  
<script type="text/javascript" src="/js/bootstrap.scrollspy.js?v=0.4.5.2" id="bootstrap.scrollspy.custom"></script>


<script type="text/javascript" id="sidebar.toc.highlight">
  $(document).ready(function () {
    var tocSelector = '.post-toc';
    var $tocSelector = $(tocSelector);
    var activeCurrentSelector = '.active-current';

    $tocSelector
      .on('activate.bs.scrollspy', function () {
        var $currentActiveElement = $(tocSelector + ' .active').last();

        removeCurrentActiveClass();
        $currentActiveElement.addClass('active-current');

        $tocSelector[0].scrollTop = $currentActiveElement.position().top;
      })
      .on('clear.bs.scrollspy', function () {
        removeCurrentActiveClass();
      });

    function removeCurrentActiveClass () {
      $(tocSelector + ' ' + activeCurrentSelector)
        .removeClass(activeCurrentSelector.substring(1));
    }

    function processTOC () {
      getTOCMaxHeight();
      toggleTOCOverflowIndicators();
    }

    function getTOCMaxHeight () {
      var height = $('.sidebar').height() -
                   $tocSelector.position().top -
                   $('.post-toc-indicator-bottom').height();

      $tocSelector.css('height', height);

      return height;
    }

    function toggleTOCOverflowIndicators () {
      tocOverflowIndicator(
        '.post-toc-indicator-top',
        $tocSelector.scrollTop() > 0 ? 'show' : 'hide'
      );

      tocOverflowIndicator(
        '.post-toc-indicator-bottom',
        $tocSelector.scrollTop() >= $tocSelector.find('ol').height() - $tocSelector.height() ? 'hide' : 'show'
      )
    }

    $(document).on('sidebar.motion.complete', function () {
      processTOC();
    });

    $('body').scrollspy({ target: tocSelector });
    $(window).on('resize', function () {
      if ( $('.sidebar').hasClass('sidebar-active') ) {
        processTOC();
      }
    });

    onScroll($tocSelector);

    function onScroll (element) {
      element.on('mousewheel DOMMouseScroll', function (event) {
          var oe = event.originalEvent;
          var delta = oe.wheelDelta || -oe.detail;

          this.scrollTop += ( delta < 0 ? 1 : -1 ) * 30;
          event.preventDefault();

          toggleTOCOverflowIndicators();
      });
    }

    function tocOverflowIndicator (indicator, action) {
      var $indicator = $(indicator);
      var opacity = action === 'show' ? 1 : 0;
      $indicator.velocity ?
        $indicator.velocity('stop').velocity({
          opacity: opacity
        }, { duration: 100 }) :
        $indicator.stop().animate({
          opacity: opacity
        }, 100);
    }

  });
</script>

<script type="text/javascript" id="sidebar.nav">
  $(document).ready(function () {
    var html = $('html');
    var TAB_ANIMATE_DURATION = 200;
    var hasVelocity = $.isFunction(html.velocity);

    $('.sidebar-nav li').on('click', function () {
      var item = $(this);
      var activeTabClassName = 'sidebar-nav-active';
      var activePanelClassName = 'sidebar-panel-active';
      if (item.hasClass(activeTabClassName)) {
        return;
      }

      var currentTarget = $('.' + activePanelClassName);
      var target = $('.' + item.data('target'));

      hasVelocity ?
        currentTarget.velocity('transition.slideUpOut', TAB_ANIMATE_DURATION, function () {
          target
            .velocity('stop')
            .velocity('transition.slideDownIn', TAB_ANIMATE_DURATION)
            .addClass(activePanelClassName);
        }) :
        currentTarget.animate({ opacity: 0 }, TAB_ANIMATE_DURATION, function () {
          currentTarget.hide();
          target
            .stop()
            .css({'opacity': 0, 'display': 'block'})
            .animate({ opacity: 1 }, TAB_ANIMATE_DURATION, function () {
              currentTarget.removeClass(activePanelClassName);
              target.addClass(activePanelClassName);
            });
        });

      item.siblings().removeClass(activeTabClassName);
      item.addClass(activeTabClassName);
    });

    $('.post-toc a').on('click', function (e) {
      e.preventDefault();
      var targetSelector = escapeSelector(this.getAttribute('href'));
      var offset = $(targetSelector).offset().top;
      hasVelocity ?
        html.velocity('stop').velocity('scroll', {
          offset: offset  + 'px',
          mobileHA: false
        }) :
        $('html, body').stop().animate({
          scrollTop: offset
        }, 500);
    });

    // Expand sidebar on post detail page by default, when post has a toc.
    motionMiddleWares.sidebar = function () {
      var $tocContent = $('.post-toc-content');
      if (CONFIG.sidebar === 'post') {
        if ($tocContent.length > 0 && $tocContent.html().trim().length > 0) {
          displaySidebar();
        }
      }
    };
  });
</script>



  <script type="text/javascript" src="/js/bootstrap.js"></script>

  
  

  
  

</body>
</html>
